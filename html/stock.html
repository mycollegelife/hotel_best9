
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../css/reset.css">
	<!-- <link rel="stylesheet" href="../css/common.css"> -->
	<link rel="stylesheet" href="../css/public.css">
	<link rel="stylesheet" href="../css/manage.css">
	<link rel="stylesheet" href="../css/memberStock.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="../js/index.js"></script>
	<script src="../js/memberStockTop.js"></script>

	<style>
		a{
			cursor: pointer;
			user-select: none;
		}
		.manage_main{
			overflow: hidden !important;
			overflow-y: auto !important;
		}

	/*加减号*/
		.img_minus img{
			width: 0.16rem;
			height: 0.02rem;
			margin-top: 0.07rem;
			display: block;
		}
		.img_add img{
			width: 0.16rem;
			height: 0.16rem;
			display: block;

		}
	/*黑色  红色  蓝色  绿色   的鱼头样式*/
		.tag_black{
			background-color: #333333;
		}
		.tag_black:before{
		 border-right:10px solid #333;
		}
		.tag_red{
			background-color: #FF1A1A;
		}
		.tag_red:before{
		 border-right:10px solid #FF1A1A;
		}
		.tag_blue{
			background-color: #1AA3FF;
		}
		.tag_blue:before{
		 border-right:10px solid #1AA3FF;
		}
		.tag_green{
			background-color: #8ACC15;
		}
		.tag_green:before{
		 border-right:10px solid #8ACC15;
		}
	/*库存 信息  主界面*/
		.stock_main{
			padding: 0.2rem 0.3rem 0.1rem 0.2rem;
		}
		.stock_main li{
			width: 16.2rem;
			margin-bottom: 0.2rem;
		}

		.stock_main li dd{
			display: none;
		}
		.stock_main li:nth-child(1) dd{
			display: block;
		}

		.stock_main li .two_title .my_inner{
			display: none;
		}

		.stock_main li .one_title{
			height: 0.5rem;
			width: 100%;
			background: rgba(255,255,255,1);
			box-shadow: 3px 3px 4px 0px rgba(0, 0, 0, 0.16);
			margin-bottom: 0.1rem;
			position: relative;
			display: flex;
			align-items: center;
		}
		.stock_main li .one_title div{
			position: absolute;
			font-size: 0px;
		}
		.stock_main li .one_title div:nth-child(1){
			width: 0.16rem;
			height: 0.16rem;
			top: 0.17rem;
			left: 0.2rem;
			user-select: none;
		}
		.stock_main li .one_title div:nth-child(2){
			left: 1rem;
			font-size: 0.24rem;
		}
		.stock_main li .one_title div:last-child{
			right:0.25rem;

		}
		.stock_main li .one_title div:last-child .button{
			margin-left: 0.3rem;
		}
		.stock_main li .one_title div:last-child .svg_style{
			margin-right: 0px;
			margin-left: 0.2rem;
			margin-top: 0.1rem;
		}
		.stock_main li dd{
			margin-left: 0.4rem;
			width: 15.8rem;
			height: auto;
		}
		.stock_main li dd .my_inner{
			width: 100%;
			box-sizing: border-box;
			padding: 0rem 0.6rem 0rem 0.3rem;
			background: rgba(255,255,255,.9);
			margin-bottom: 0.1rem;
		}
		.stock_main li dd .two_title .my_inner{
			width: 15.1rem;
			margin-left: 0.7rem;
		}

	/*库存信息 搜索   后显示样式*/
		.history_model li.stockMain_title dt{
			width: 5.2rem;
			height: 0.4rem;

			font-size: 0px;
			margin: 0 auto;
		}
		.history_model li.stockMain_title dt button{
			width: 1.3rem;
			height: 0.4rem;
			text-align: center;
			font-size: 0.18rem;
			border: 0px;
			outline: none;
			background-color: #fff;
		}
		.history_model li.stockMain_title dt button.hover{
			color: #fff;
			background-color: #FF761A;
			box-shadow: 0px 0px 4px rgba(0,0,0,.16);
		}

		/*.history_model li:nth-child(2) dd.my_inner{
			display: block;
		}*/
		.history_model li dt div:nth-child(2) span{
			font-size: 0.24rem;
			margin-right: 0.5rem;
		}
		.history_model li dt div:nth-child(3){
			left: 6rem !important;
		}
		.history_model li dd{
			width: 15.1rem;
			margin-left: 1.1rem;
		}
		.history_model li dd.my_inner{
			box-sizing: border-box;
			padding: 0rem 0.6rem 0rem 0.3rem;
			background: rgba(255,255,255,.9);
			margin-bottom: 0.1rem;
		}
		.history_model .myTable_title{
			padding-top: 0.2rem;
			font-size: 0.2rem;
			color: #FF761A;
		}
		.history_model .myTable_title div{
			display: inline-block;
		}
		.history_model .myTable_title div:nth-child(1){
			border-left: 0.03rem solid #FF761A;
			font-weight: bold;
			padding-left: 0.1rem;
		}
		.history_model .myTable_title div:nth-child(2){
			margin-right: 0.6rem
		}


	/*入库管理的样式*/
	

	/*出库管理的样式*/

		.outStorage_main{
			padding: 0.2rem;
		}
		.om_con {
			background-color: #fff;
			padding: 0rem 0.3rem;
			box-shadow: 3px 3px 4px 0px rgba(0, 0, 0, 0.16);
		}
		.om_con .myTable tr td{
			padding: 0.1rem 0rem ;
			text-align: center ;
		}
		.om_con .myTable tr td:first-child{
			width: 1.5rem;
		}
		.om_con .myTable thead tr{
			/*background-color: #F2F2F2;*/
		}
		.om_con .myTable tbody tr td{
			padding: 0.05rem  !important;
		}
		.om_con .myTable tbody tr td:last-child{
			width: 3.4rem;
		}
		.om_con .myTable tbody tr td:last-child button{
			margin-left: 0.15rem;
			margin-right: 0.15rem;
		}
</style>
<script type="text/javascript">
	$(window).resize(function ()
	{
		

		// 设置右下角内容区  li下 my_inner 的高度
			function setInnerHeight(target) {
			    var tabH = $(target).find(".my_innerbox").height();
			    if (tabH>500) {
			    	$(target).css("height",5+"rem");
			    	$(target).css("overflow-y","scroll");
			    	
			    	$(target).find(".my_innerbox").css("overflow-y","auto");
			    }else{
			    	$(target).css("height",tabH);
			    }
			}
			function set_inner_height(){
				var addminus = $(".stock_main li dt div:nth-child(1)");
				for (var i = 0; i < addminus.length; i++) {
					if(addminus.eq(i).hasClass("img_minus")){
						setInnerHeight(addminus.eq(i).parent().next());// 设置 my_inner 的高度
					}
				}
			}
			// set_inner_height();

		// 设置
			
		
	});
	$(window).resize();
	

</script>

</head>
<body>
<div class="wrap">
<nav id="nav" class="nav">
	<div class="nav_logo">
		<span class="hotel_name">卡拉曼达涪城万达店</span>
		<img src="../imgs/logo.png" alt="">

	</div>
	<div class="nav_menu">
	  	<ul>
	  		<li><a href="../index.html">餐台</a></li>
	  		<li><a href="">订单</a></li>
	  		<li><a href="">报表</a></li>
	  		<li><a href="member.html">会员</a></li>
	  		<li><a href="">营销</a></li>
	  		<li><a href="manage.html">管理</a></li>
	  		<li><a class="active"  href="#">库存</a></li>
	  		<li><a href="">其它</a></li>
	  	</ul>
	</div>
	<div class="nav_user">
		<span class="user_info">
			<i class="online_user">萧经滕</i>
			<br>
			<i class="online_time">已在线2小时30分</i>
		</span>
		<img class="user_head" src="../imgs/touxiang.png" alt="">

	</div>
</nav>
<div id="manage">
<!-- 左边导航栏 -->
	<div id="manage_menu" class="manage_menu">
		<ul class="ul_style">
			<li class="dropdown drop" >
			   	<img src="../imgs/manage/stock_logo.svg" alt="" class="ul_logo">
				<span>库存管理</span>
			   	<img src="../imgs/manage/arrow_right.svg" alt="" class="triangle">
				<dl class="dropdown_menu" >
					<dt class="hover">
						<span>|</span>
						<a href="javacript:;" id="inventory_info">库存信息</a>
					</dt>
					<dt><a href="javacript:;" id="enter_storage">入库管理</a></dt>
					<dt><a href="javacript:;" id="out_storage">出库管理</a></dt>
				</dl>
			</li>
		</ul>
	</div>
<!-- 右边内容区 -->
	<div id="member_content" class="manage_content">
	</div>
</div>
</div>
<script src="../js/memberStockBottom.js"></script>
<!-- 图片的上传处理 -->

<script>
	// 设置右下角内容区  li下 my_inner 的高度  和 设置表格的表头
		function setInnerHeight(target,theadFun) {
		    var tabH = $(target).find(".my_innerbox").height();
		    console.log(tabH)

		    if (tabH>500) {
		    	$(target).css("height",5+"rem");
		    	$(target).css("overflow-y","auto");
		    	
		    	theadFun(target);//置表格的表头
		    }else{
		    	$(target).css("height",tabH);
		    }
		}


	// 设置表格的表头固定
		function fix_thead(target){
			// 滚动固定表格的头  $(this) == my_inner
			$(target).scroll(function () {

			    var scrollH = $(this).scrollTop() -1;	
				
			    $(this).find("thead").css({
			    	transform: "translateY("+scrollH+"px)",
			    });
			    $(this).find("thead").children().addClass("hover");//变颜色

			    //设置 hr 的高度
			    var hrThead = $(this).find("thead").height()+1;

			    $(this).find("hr").css({
			    	transform: "translateY("+scrollH+"px)",
			    	top:""+hrThead+"px"
			    });
			    $(this).find("hr").addClass("hover");//显示

				if ($(this).scrollTop() == 0) {
					$(this).find("thead").children().removeClass("hover");
			    	$(this).find("hr").removeClass("hover")
				}
			});
		}
	
	// 表格表头的占位函数
		function unfix_thead(target){
			console.log("这个是占位函数")
		}

	// 点击加减号展开收起 
		function add_minus(ev,evFuture,addClassify){
			$(ev).on("click",evFuture,function(){
				var $add_minus = $(this);//加减号的div
				// console.log($add_minus.html());

				if ($add_minus.hasClass("img_minus")) {
					$add_minus.removeClass("img_minus");
					$add_minus.addClass("img_add");
					$add_minus.children("img").attr("src","../imgs/add.svg");

					$add_minus.parent().next().css("display","none");

					//再次点击是一级分类的隐藏二级分类内容
					var dd_first = $add_minus.parent().next().children("div:first-child");
					if (dd_first.hasClass("two_title")) {
						var ddF_first = dd_first.children().find("div:first-child");
						if (ddF_first.hasClass("img_minus") ) {
							ddF_first.removeClass("img_minus");
							ddF_first.addClass("img_add");
							ddF_first.children("img").attr("src","../imgs/add.svg");

							ddF_first.parent().next().css("display","none");
						}
					}

				}else if($add_minus.hasClass("img_add")){
					$add_minus.removeClass("img_add");
					$add_minus.addClass("img_minus");
					$add_minus.children("img").attr("src","../imgs/minus.svg");

					addClassify($add_minus);//分类的加减号
				}
			})
		}

		// 一级分类加号点击(库存信息)
			function add_oneClassify($add_minus){
				// console.log("1级分类加号点击")

				var dd_main = $add_minus.parent().next();//获取dd标签
				if (dd_main.children().length == "0") {//一级分类 dd 没有内容
					var first_token = $add_minus.parent().find(".myDisplay").html();//一级分类的token
					var type_token = "";
					var twoClass_con = "";// 判断一级分类 加载不同的二级分类
					if (first_token == "1") {
						twoClass_con = goods_dataTwo;
					}else if(first_token =="2"){
						twoClass_con = devices_dataTwo;
					}else if(first_token =="3"){
						twoClass_con = drinks_dataTwo;
					}else if(first_token =="4"){
						twoClass_con = others_dataTwo;
					};
					var myUrl = "/snug/queryGoodsByFirAndTow";

					oneClass_ajax(twoClass_con,first_token,type_token,dd_main,myUrl)//通过ajax加载一级分类下的内容
				} else {
					dd_main.css("display","block")//一级分类的展开
					// setInnerHeight(dd_main,fix_thead);
				}
			}

		// 2级分类加号点击(库存信息)
			function add_twoClassify($add_minus){
				var first_token = $add_minus.parent().parent().parent().parent().find(".myDisplay").html();
				var type_token = $add_minus.siblings(".myDisplay").html();
				// console.log("二级分类加号点击first_token:"+first_token+"type_token"+type_token)
				
				var twoClass_con = "";// 判断一级分类 加载不同的二级分类
				if (first_token == "1") {
					twoClass_con = goods_dataTwo;
				}else if(first_token =="2"){
					twoClass_con = devices_dataTwo;
				}else if(first_token =="3"){
					twoClass_con = drinks_dataTwo;
				}else if(first_token =="4"){
					twoClass_con = others_dataTwo;
				};
				
				var type_main = $add_minus.parent().parent();//div.two_title 二级分类
				if ($add_minus.parent().next().length == "0") {//二级分类没有my_inner内容
					// console.log("二级分类没有my_inner内容")

					$.ajax({//通过ajax得到内容
						url:"/snug/queryGoodsByFirAndTow",
						data:{
							firstfather : first_token,
							towtoken : type_token
						},
						success:function(data){
							var data = JSON.parse(data);
							var myData_fir = data.info;
							console.log(data)
							
							if (data.status == "1") {
								var str = "";
								
								twoClass_con(myData_fir,str,type_main);//加载二级分类的内容
								
								type_main.children(".my_inner").css("display","block");//有内容时设置显示状态
							
								setInnerHeight($add_minus.parent().parent().children(".my_inner"),fix_thead);

							} else {
								console.log("点击分类加载失败！")
							}
						},
						error:function(){
							console.log("点击分类加载失败！")
						}
					})
				} else {
					type_main.find(".my_inner").css("display","block");//有内容时设置显示状态
				}
			}

		// 一级分类点击加减号展开收起(入库管理)
			function add_inStock($add_minus){

				var dd_main = $add_minus.parent().next();//获取dd标签
				if (dd_main.children().length == "0") {//一级分类 dd 没有内容
					var token = $add_minus.children("span").html();//一级分类的token
					console.log(token);
					$.ajax({
						url:"/snug/queryInGoodMes",
						data:{attence_info_token:token},
						success:function(data){
							var data = JSON.parse(data);
							var data_goods = data.info;

							var str_firReturn = add_inStockCon(data_goods);//li 的内容
							var strFirReturn = '<div class="my_innerbox">'+str_firReturn+'</div>';
							dd_main.html(strFirReturn);

							dd_main.css("display","block")//一级分类的展开
							setInnerHeight(dd_main,unfix_thead);
						}
					});
				} else {
					dd_main.css("display","block")//一级分类的展开
					
				}
			}


	//申购清单的历史数据和入库管理的  顶部 点击切换  审核状态
		


/*-----------------------------------点击库存管理-----------------------------*/
	// 库存里 公用的tbody 和 thead 的内容 （库存信息 库存信息查询 入库管理）
		//商品
		function goods_dataTbody(myData_fir){
			var str_fir = "";
			for (var i = 0; i < myData_fir.length; i++) {//一级分类下的tbody
				str_fir+='<tr> <td>'+myData_fir[i].food_material_name+'</td> <td>商品</td> <td>'+myData_fir[i].food_material_number+'</td> <td>'+myData_fir[i].food_material_unit+'</td> <td>'+myData_fir[i].food_material_inprice+'</td> <td>'+myData_fir[i].food_material_min_inventory+'</td> <td>'+myData_fir[i].food_material_max_inventory+'</td> <td>'+myData_fir[i].food_material_outprice+'</td> <td>'+myData_fir[i].food_material_guarantee+'</td> </tr>';
			}
			return str_fir;
		}
		function goods_dataThead(str_fir){
			var str = '<table class="myTable  my_innerbox"> <thead> <tr> <td>名称</td> <td>属性</td> <td>库存数量</td> <td>单位</td> <td>采购单价</td> <td>最低库存</td> <td>最高库存</td> <td>出售单价</td> <td>保质期</td> </tr> </thead> <tbody>'+str_fir+'</tbody> </table>'
			return str;
		}
		//设备
		function devices_dataTbody(myData_fir){
			var str_fir = "";	
			for (var i = 0; i < myData_fir.length; i++) {//一级分类下的tbody
				str_fir+='<tr> <td>'+myData_fir[i].food_material_name+'</td> <td>设备</td> <td>'+myData_fir[i].food_material_number+'</td> <td>'+myData_fir[i].food_material_unit+'</td> <td>'+myData_fir[i].food_material_inprice+'</td> <td>'+myData_fir[i].food_material_min_inventory+'</td> <td>'+myData_fir[i].food_material_max_inventory+'</td><td>使用年限</td><td>'+myData_fir[i].food_material_servicelift+'</td><td>折旧</td> </tr>';
			}
			return str_fir;
		}
		function devices_dataThead(str_fir){
			var str = '<table class="myTable  my_innerbox"> <thead> <tr> <td>名称</td> <td>属性</td><td>库存数量</td><td>单位</td> <td>采购单价</td> <td>最低库存</td> <td>最高库存</td> <td>使用年限</td> <td>维保周期</td> <td>折旧</td> </tr> </thead> <tbody>'+str_fir+'</tbody> </table>'
			return str;
		}
		//酒水
		function drinks_dataTbody(myData_fir){
			var str_fir = "";	
			for (var i = 0; i < myData_fir.length; i++) {//一级分类下的tbody
				str_fir+='<tr> <td>'+myData_fir[i].wine_info_name+'</td> <td>酒水</td> <td>'+myData_fir[i].wine_info_max_numbers+'</td> <td>'+myData_fir[i].wine_info_unit+'</td> <td>'+myData_fir[i].wine_info_price_low+'</td> <td>'+myData_fir[i].wine_info_min_inventory+'</td> <td>'+myData_fir[i].wine_info_max_inventory+'</td><td>'+myData_fir[i].wine_info_price_high+'</td><td>'+myData_fir[i].wine_info_guarantee+'</td><td>'+myData_fir[i].wine_info_commission_price+'</td> </tr>';
			}
			return str_fir;
		}
		function drinks_dataThead(str_fir){
			var str = '<table class="myTable  my_innerbox"> <thead> <tr> <td>名称</td> <td>属性</td><td>库存数量</td><td>单位</td> <td>采购单价</td> <td>最低库存</td> <td>最高库存</td> <td>出售单价</td> <td>保质期</td> <td>售卖提成</td> </tr> </thead> <tbody>'+str_fir+'</tbody> </table> '
			return str;
		}
		//其他
		function others_dataTbody(myData_fir){
			var str_fir = "";	
			for (var i = 0; i < myData_fir.length; i++) {//一级分类下的tbody
				str_fir+='<tr> <td>'+myData_fir[i].othersgoods_info_name+'</td> <td>其他</td> <td>'+myData_fir[i].othersgoods_info_max_numbers+'</td> <td>'+myData_fir[i].othersgoods_info_unit+'</td> <td>'+myData_fir[i].othersgoods_info_price_low+'</td> <td>'+myData_fir[i].othersgoods_info_min_inventory+'</td> <td>'+myData_fir[i].othersgoods_info_max_inventory+'</td><td>'+myData_fir[i].othersgoods_info_price_high+'</td><td>'+myData_fir[i].othersgoods_info_guarantee+'</td> </tr>';
			}
			return str_fir;
		}
		function others_dataThead(str_fir){
			var str = '<table class="myTable  my_innerbox"> <thead> <tr> <td>名称</td> <td>属性</td> <td>库存数量</td> <td>单位</td> <td>采购单价</td> <td>最低库存</td> <td>最高库存</td> <td>出售单价</td> <td>保质期</td> </tr> </thead> <tbody>'+str_fir+'</tbody> </table>'
			return str;
		}

	// 库存信息 在搜索时对内容的 样式 设置
		function setStockCon(stock_main){
			stock_main.find("li dd").html("");
			var stockM_li = stock_main.find("li");
			for (var i = 0; i < stockM_li.length; i++) {//清空减号
				var stock_add = stockM_li.eq(i).find("dt div:first-child");
				if (stock_add.hasClass("img_minus")) {
					stock_add.removeClass("img_minus");
					stock_add.addClass("img_add");
					stock_add.children("img").attr("src","../imgs/add.svg");
				}
			}
			var stock_add0 = stockM_li.eq(0).find("dt div:first-child");
			if (stock_add0.hasClass("img_add")) {//设置第一个为减号
				stock_add0.removeClass("img_add");
				stock_add0.addClass("img_minus");
				stock_add0.children("img").attr("src","../imgs/minus.svg");
				stockM_li.eq(0).find("dd").css("display","block");
			}
		}

	//库存默认加载函数
	function stockLoad(){
		$("#member_content").load("stock/stockInfo.html",function(){
			setConHeight();//设置右下内容模板高度
			
			add_minus(".stock_main li dt","div:nth-child(1)",add_oneClassify);// 一级分类点击加减号展开收起
			add_minus(".stock_main li dd",".one_title div:nth-child(1)",add_twoClassify);// 二级分类点击加减号展开收起

			// setInnerHeight(".stock_main li dd",fix_thead)
			
			var first_token = "";
			var type_token = "";
			var dd_main = $(".stockInfo_main li:first-child dd");
			var twoClass_con = goods_dataTwo;//商品一级分类内容
			var myUrl = "/snug/queryGoodsMes";

			oneClass_ajax(twoClass_con,first_token,type_token,dd_main,myUrl);//通过ajax加载一级分类下的内容

			// 点击搜索
			$("#stockInfo_select").bind("input propertychange",function(){
				// console.log($("#stockInfo_select").val());
				
				var $selectVal = $("#stockInfo_select").val();
				console.log($("#stockInfo_select").val());

				var stock_main = $(".stock_main");
				
				if ($selectVal == "") {
					stock_main.removeClass("history_model");
					stock_main.find("li dd").removeClass("my_inner")
					
					setStockCon(stock_main);//设置内容的样式

					oneClass_ajax(goods_dataTwo,"","",$(".stockInfo_main li:first-child dd"),"/snug/queryGoodsMes");//通过ajax加载一级分类下的内容
				} else {
					stock_main.addClass("history_model");
					stock_main.find("li dd").addClass("my_inner")
					
					setStockCon(stock_main);//设置内容的样式
				
					$.ajax({
						url:"/snug/queryAllGoodsMes",
						data:{key_word:"123"},
						
						success:function(data){
							var data = JSON.parse(data);
							console.log(data)

							var data_goods = data.goods_array;
							var data_equ = data.equ_array;
							var data_wine = data.wines_array;
							var data_othersgoods = data.othersgoodss_array;
							
							var dd_main1 = $(".history_model li:nth-child(1) dd");
							var dd_main2 = $(".history_model li:nth-child(2) dd");
							var dd_main3 = $(".history_model li:nth-child(3) dd");
							var dd_main4 = $(".history_model li:nth-child(4) dd");
							


							// goods_dataTable 是商品的  其他三个没有写
							stockInfo_dataSelect(data_goods,dd_main1,goods_dataTbody,goods_dataThead);//商品的内容处理
							stockInfo_dataSelect(data_equ,dd_main2,devices_dataTbody,devices_dataThead);//设备的内容处理
							stockInfo_dataSelect(data_wine,dd_main3,drinks_dataTbody,drinks_dataThead);//酒水的内容处理
							stockInfo_dataSelect(data_othersgoods,dd_main4,others_dataTbody,others_dataThead);//其他的内容处理
						}
					})
				}

			});

		})
	}
	stockLoad();

	// 点击库存信息
		$("#inventory_info").click(function(){
			stockLoad();
		})

	// 库存信息一级分类的 ajax
		function oneClass_ajax(twoClass_con,first_token,type_token,dd_main,myUrl){
			$.ajax({
				url:myUrl,
				data:{
					firstfather : first_token,
					towtoken : type_token
				},
				success:function(data){
					var data = JSON.parse(data);
					console.log(data)
					if (data.status == "1") {
						stockInfo_dataOne(data,dd_main,twoClass_con);//加载一级分类内容
						
						dd_main.css("display","block")//一级分类的展开
						
						setInnerHeight(dd_main.children(".my_inner"),fix_thead);
						
					} else {
						console.log("库存管理获取列表失败！")
					};
				},
				error:function(){
					console.log("库存管理获取列表失败！")
				}
			})
		}

	// 库存信息  处理数据   函数
		function stockInfo_dataOne(data,dd_main,twoFun){//一级分类   的数据处理
			var myData_fir = data.info;
			var myData_type = data.sec_type;
			var str = "";	
			if (myData_type.length>0) {//二级分类的标题
				for (var i = 0; i < myData_type.length; i++) {
					str+='<div class="two_title"> <div class="one_title"> <div class="img_add"> <img src="../imgs/add.svg" alt=""> </div> <div>'+myData_type[i].category_info_name+'</div><span class="myDisplay">'+myData_type[i].category_info_token+'</span></div> </div>'
				}
			}
			twoFun(myData_fir,str,dd_main)//一级分类数据
		}

		//商品
		function goods_dataTwo(myData_fir,str,dd_main){//二级分类  商品的数据处理
			// console.log("二级分类 商品的数据处理")
			if (myData_fir.length>0) {
				var str_fir = goods_dataTbody(myData_fir);
				str+='<div class="my_inner"> <hr>'+goods_dataThead(str_fir)+'</div>';;

			}else{
				str+='<div class="my_inner"> <hr> <table class="myTable  my_innerbox"> <thead> <tr> <td>该分类下没有相关商品</td><td></td></thead></table> </div>'
			}
			dd_main.append(str);
		}
		// 设备
		function devices_dataTwo(myData_fir,str,dd_main){//二级分类  设备 的数据处理
			// console.log("二级分类 设备的数据处理")
			if (myData_fir.length>0) {
				var str_fir =devices_dataTbody(myData_fir);
				str+='<div class="my_inner"> <hr>'+devices_dataThead(str_fir)+'</div>';
			}else{
				str+='<div class="my_inner"> <hr> <table class="myTable  my_innerbox"> <thead> <tr> <td>该分类下没有相关设备</td><td></td></thead></table> </div>'
			}
			dd_main.append(str);
		}
		// 酒水
		function drinks_dataTwo(myData_fir,str,dd_main){//二级分类  设备 的数据处理
			// console.log("二级分类 酒水的数据处理")
			if (myData_fir.length>0) {
				var str_fir = drinks_dataTbody(myData_fir); 
				str+='<div class="my_inner"> <hr>'+drinks_dataThead(str_fir)+'</div>';

			}else{
				str+='<div class="my_inner"> <hr> <table class="myTable  my_innerbox"> <thead> <tr> <td>该分类下没有相关酒水</td><td></td></thead></table> </div>'
			}
			dd_main.append(str);
		}
		// 其他
		function others_dataTwo(myData_fir,str,dd_main){//二级分类  设备 的数据处理
			// console.log(               "二级分类 酒水的数据处理")
			if (myData_fir.length>0) {
				var str_fir = others_dataTbody(myData_fir);
				str+='<div class="my_inner"> <hr> '+others_dataThead(str_fir)+'</div>';

			}else{
				str+='<div class="my_inner"> <hr> <table class="myTable  my_innerbox"> <thead> <tr> <td>该分类下没有相关物品</td><td></td></thead></table> </div>'
			}
			dd_main.append(str);
		}

	// 库存信息  搜索    后处理数据函数
		function stockInfo_dataSelect(data_goods,dd_main1,goods_dataTbody,goods_dataThead){
			if (data_goods.fir_goods.length>0 || data_goods.sec_goods.length>0) {
				console.log(data_goods);
				var str = "";
				
				// 遍历二级分类的数据
				for (var i = 0; i < data_goods.sec_goods.length; i++) {	
					var two_goods = data_goods.sec_goods[i].goods;
					var	two_title = data_goods.sec_goods[i].sec_type_name;
					console.log(two_title);
					if (two_title == "") {
						two_title = "";
					}else{
						two_title = '-&nbsp;<span>'+two_title+'</span>';
					}
					str += std_SelectTable(two_goods,two_title,goods_dataTbody,goods_dataThead);//加载内容
				}

				// 遍历一级分类的数据
				for (var i = 0; i < data_goods.fir_goods.length; i++) {
					var two_title = "";
					str += std_SelectTable(two_goods,two_title,goods_dataTbody,goods_dataThead);//加载内容
				}
				dd_main1.html(str);
			}else{
				var str ='<div class="my_inner"> <hr> <table class="myTable  my_innerbox"> <thead> <tr> <td>该分类下没有搜索到相关商品</td><td></td></thead></table> </div>'
				dd_main1.html(str);

			}
		}
		//商品  设备 酒水 其他的表格内容处理
		function std_SelectTable(two_goods,two_title,goods_dataTbody,goods_dataThead){
			var str ="";
			var str_fir = goods_dataTbody(two_goods);
			str+='<div class="my_innerbox"> <div class="myTable_title"> <div>商品</div> <div>'+two_title +'</div> </div> '+goods_dataThead(str_fir)+'</div></dd>'
			return str;
		}
		

	// 点击 入库管理
		$("#enter_storage").click(function(){
			$("#member_content").load("stock/enterStorage.html",function(){
				setConHeight();//设置右下内容模板高度
				
			// 设置右下角内容区 my_inner 的高度
				var good_mo_hei = $(".manage_main").height();
				var ratio = window.innerWidth *100/1920;//计算比例
				var tem_hei = good_mo_hei - 0.9*ratio;
				$(".my_inner").css("height",tem_hei+"px");//设置miy_inner的高度			
				
				var tabHei = $(".my_innerbox").height();
				var divHei = $(".my_inner").height();
				
				if (tabHei > divHei) {
					$(".my_inner").css("overflow-y","auto");
					fix_thead(".my_inner")
				}

			// 时间选择器
				$("#time_select").flatpickr({
					mode: "range",
					maxDate: "today",
					dateFormat: "Y-m-d",
					defaultDate: ["today", "today"],
				});

			// 获取数据
				// time = "2018-02-09 00:00:00,2018-02-09 23:59:59";
				outStock_data("","","1","4");
			

			// 通过名称搜索
				$("#outStock_select").bind("input propertychange",function(){
					var name = $(this).val()
					var status = outStock_status($(".om_title li"));//判断 出库的状态
					var time = outStock_time($("#time_select"));// 获取时间

					outStock_data(name,time,"1",status);
				})

			// 通过时间搜索
				$("#time_select").bind("input propertychange",function(){
					
					var name = $("#outStock_select").val();
					var status = outStock_status($(".om_title li"));//判断 出库的状态
					var time = outStock_time($(this));// 获取时间
					console.log(time);
					
					outStock_data(name,time,"1",status);
				})

			// 通过状态搜索
				$(".om_title li").click(function(){
					$(this).addClass("hover");
					$(this).siblings().removeClass("hover");
					
					var name = $("#outStock_select").val();
					var time = outStock_time($("#time_select"));
					var status = outStock_status($(this));
					
					// console.log(name+time+status)
					outStock_data(name,time,"1",status);
				})

			})
		})
		

	// 点击 出库管理
		$("#out_storage").click(function(){
			$("#member_content").load("stock/outStorage.html",function(){
				setConHeight();//设置右下内容模板高度
				
			// 设置右下角内容区 my_inner 的高度
				var good_mo_hei = $(".manage_main").height();
				var ratio = window.innerWidth *100/1920;//计算比例
				var tem_hei = good_mo_hei - 0.9*ratio;
				$(".my_inner").css("height",tem_hei+"px");//设置miy_inner的高度			
				
				var tabHei = $(".my_innerbox").height();
				var divHei = $(".my_inner").height();
				
				if (tabHei > divHei) {
					$(".my_inner").css("overflow-y","auto");
					fix_thead(".my_inner")
				}

			// 时间选择器
				$("#time_select").flatpickr({
					mode: "range",
					maxDate: "today",
					dateFormat: "Y-m-d",
					defaultDate: ["today", "today"],
				});

			// 获取数据
				// time = "2018-02-09 00:00:00,2018-02-09 23:59:59";
				outStock_data("","","1","4");
			

			// 通过名称搜索
				$("#outStock_select").bind("input propertychange",function(){
					var name = $(this).val()
					var status = outStock_status($(".om_title li"));//判断 出库的状态
					var time = outStock_time($("#time_select"));// 获取时间

					outStock_data(name,time,"1",status);
				})

			// 通过时间搜索
				$("#time_select").bind("input propertychange",function(){
					
					var name = $("#outStock_select").val();
					var status = outStock_status($(".om_title li"));//判断 出库的状态
					var time = outStock_time($(this));// 获取时间
					console.log(time);
					
					outStock_data(name,time,"1",status);
				})

			// 通过状态搜索
				$(".om_title li").click(function(){
					$(this).addClass("hover");
					$(this).siblings().removeClass("hover");
					
					var name = $("#outStock_select").val();
					var time = outStock_time($("#time_select"));
					var status = outStock_status($(this));
					
					// console.log(name+time+status)
					outStock_data(name,time,"1",status);
				})

			})
		})
// 出库管理 搜索的数据处理	
	function outStock_data(name,time,type,status){
		$.ajax({
			url:"/snug/queryByTimeAndName",
			data:{
				key_name:name,
				key_time:time,
				manage_type:type,
				status_type:status
			},
			success:function(data){
				var data =JSON.parse(data);
				console.log(data);
				if (data.status == 1) {
					var myData = data.info;
					if (myData.length>0) {
						var btn= "";
						var str="";
						for (var i = 0; i < myData.length; i++) {//tbody塞内容
							var thisStatus = myData[i].food_material_out_flag;
							if (thisStatus == "4") {// 判断 button按钮
								btn = ' <button class="button">通过</button> <button class="button">不通过</button>';
							}else if(thisStatus == "5"){
								btn = ' <button class="button btn_red">反通过</button>'
							}else if(thisStatus == "6"){
								btn = ' <button class="button btn_red">重申入库</button>'
							}
							str+='<tr> <td>'+myData[i].food_material_out_name+'</td> <td> <span>'+myData[i].food_material_out_type+'</span></td> <td>'+myData[i].food_material_out_to_department+'</td> <td>'+myData[i].food_material_out_quantity+'</td> <td>'+myData[i].food_material_out_time+'</td> <td>'+btn+'</td> </tr>'
						}
						$(".om_con tbody").html(str);

						if (status == "") {//全部时  添加td
							var theadOperate =  $(".om_con thead td:last-child");
							var tbodyOperate =  $(".om_con tbody tr");

							if (! $(".om_con thead td").hasClass("theadOperate")) {
								theadOperate.before("<td class='theadOperate'>状态</td>");
							}
							var tag,tag_color;
							for (var i = 0; i < myData.length; i++) {
								var thisStatus = myData[i].food_material_out_flag;
								if (thisStatus == "4") {// 判断 状态
									tag= "待审核";
									tag_color = "tag_blue";
								}else if(thisStatus == "5"){
									tag= "已通过";
									tag_color = "tag_green";
								}else if(thisStatus == "6"){
									tag= "不通过";
									tag_color = "tag_red";
								}

								tbodyOperate.eq(i).find("td:last-child").before('<td><a class="tag '+tag_color+'">'+tag+'</a></td>');
							}
						}else{
							if ($(".om_con thead td").hasClass("theadOperate")) {
								$(".theadOperate").remove();
							}
						}
					}else{
						console.log("改情况下没有数据")
					}
				}else{
					console.log("返回状态为2！info为空")
					$(".om_con tbody").html("");
				}
			}
		})
	}
	//获取出库的状态 
		function outStock_status(statusEv){
			var status = "";
			for (var i = 0; i < statusEv.length; i++) {
				if (statusEv.eq(i).hasClass("hover")) {
					var statusVal = statusEv.eq(i).html();
					if (statusVal == "待审核") {
						status = "4";
					}else if(statusVal == "通过"){
						status = "5";
					}else if(statusVal == "不通过"){
						status = "6";
					}else if(statusVal == "全部"){
						status = "";
					}
				}
			}
			return status;
		}
	//获取搜索的时间范围
		function outStock_time(ev){
			var $key_time = ev.val();
			var $key_time1 = $key_time.substring(0,10);
			var $key_time2 = $key_time.substring(14,24);
			
			var time ="";
			if ($key_time1 !=="" && $key_time2 !=="") {
				time= $key_time1 +" 00:00:00,"+$key_time2+" 23:59:59";
			}
			return time;
		}
		
</script>
</body>
</html>
